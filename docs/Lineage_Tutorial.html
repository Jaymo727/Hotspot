<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Demo: Lineage-recorded data from Chan et al, (Nature 2019) &#8212; Hotspot 0.9.0 documentation</title>
    <link rel="stylesheet" href="_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/my-styles.css" />
    <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Demo: Transcriptional Patterns in CD4 T Cells" href="CD4_Tutorial.html" />
    <link rel="prev" title="Demo: Spatial data from Slide-seq" href="Spatial_Tutorial.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">
<script type="text/javascript" src="_static/js/jquery-1.11.0.min.js "></script>
<script type="text/javascript" src="_static/js/jquery-fix.js "></script>
<script type="text/javascript" src="_static/bootstrap-3.3.7/js/bootstrap.min.js "></script>
<script type="text/javascript" src="_static/bootstrap-sphinx.js "></script>

  </head><body>

  <div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="index.html">
          Hotspot</a>
        <span class="navbar-text navbar-version pull-left"><b>0.9.0</b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
                <li><a href="hotspot.html">API</a></li>
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="index.html">Tutorials <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ul class="current">
<li class="toctree-l1"><a class="reference internal" href="Spatial_Tutorial.html">Demo: Spatial data from Slide-seq</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Demo: Lineage-recorded data from Chan et al, (Nature 2019)</a></li>
<li class="toctree-l1"><a class="reference internal" href="CD4_Tutorial.html">Demo: Transcriptional Patterns in CD4 T Cells</a></li>
</ul>
</ul>
</li>
              
                <li class="dropdown">
  <a role="button"
     id="dLabelLocalToc"
     data-toggle="dropdown"
     data-target="#"
     href="#">This Page <b class="caret"></b></a>
  <ul class="dropdown-menu localtoc"
      role="menu"
      aria-labelledby="dLabelLocalToc"><ul>
<li><a class="reference internal" href="#">Demo: Lineage-recorded data from Chan et al, (Nature 2019)</a><ul>
<li><a class="reference internal" href="#Covered-Here">Covered Here</a></li>
<li><a class="reference internal" href="#Creating-the-Hotspot-object">Creating the Hotspot object</a></li>
<li><a class="reference internal" href="#Determining-genes-with-heritable-variation">Determining genes with heritable variation</a></li>
<li><a class="reference internal" href="#Grouping-genes-into-lineage-based-modules">Grouping genes into lineage-based modules</a></li>
<li><a class="reference internal" href="#Plotting-module-correlations">Plotting module correlations</a></li>
<li><a class="reference internal" href="#Summary-Module-Scores">Summary Module Scores</a></li>
</ul>
</li>
</ul>
</ul>
</li>
              
            
            
            
            
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="body col-md-12 content" role="main">
      
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container,
div.nbinput.container div.prompt,
div.nbinput.container div.input_area,
div.nbinput.container div[class*=highlight],
div.nbinput.container div[class*=highlight] pre,
div.nboutput.container,
div.nboutput.container div.prompt,
div.nboutput.container div.output_area,
div.nboutput.container div[class*=highlight],
div.nboutput.container div[class*=highlight] pre {
    background: none;
    border: none;
    padding: 0 0;
    margin: 0;
    box-shadow: none;
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    min-width: 7ex;
    padding-top: 0.4em;
    padding-right: 0.4em;
    text-align: right;
    flex: 0;
}
@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    padding: 0.4em;
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    background: #f5f5f5;
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}
</style>
<div class="section" id="Demo:-Lineage-recorded-data-from-Chan-et-al,-(Nature-2019)">
<h1>Demo: Lineage-recorded data from Chan et al, (Nature 2019)<a class="headerlink" href="#Demo:-Lineage-recorded-data-from-Chan-et-al,-(Nature-2019)" title="Permalink to this headline">¶</a></h1>
<p>This demo uses data from:</p>
<p><em>Molecular recording of mammalian embryogenesis</em></p>
<ul class="simple">
<li>Chan et al (Nature 2019)</li>
<li><a class="reference external" href="https://doi.org/10.1038/s41586-019-1184-5">https://doi.org/10.1038/s41586-019-1184-5</a></li>
</ul>
<p>For this demo, you need the expression data (count matrix) for Embryo3 which can be found in the NCBI GEO database under accession <a class="reference external" href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSM3302829">GSM3302829</a></p>
<p>Specifically these three files:</p>
<ul class="simple">
<li>GSM3302829_embryo3_SeuratBarcodes.tsv.gz</li>
<li>GSM3302829_embryo3_SeuratGenes.tsv.gz</li>
<li>GSM3302829_embryo3_SeuratNorm.mtx.gz</li>
</ul>
<p>The cell-type kernels (for interpreting lineage groups) are located at <a class="reference external" href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE122187">GSE122187</a></p>
<ul class="simple">
<li>GSE122187_CellStateKernels.xls.gz</li>
</ul>
<p>Additionally, a reconstructed lineage tree is provided with this notebook (same directory) as made by <a class="reference external" href="https://github.com/YosefLab/Cassiopeia">Cassiopeia</a></p>
<ul class="simple">
<li>0726_E2-2_tree_greedy_priors.processed.txt</li>
</ul>
<div class="section" id="Covered-Here">
<h2>Covered Here<a class="headerlink" href="#Covered-Here" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>Data preprocessing and filtering</li>
<li>Computing Autocorrelation in Hotspot to identify lineage-related genes</li>
<li>Computing local correlations between lineage genes to identify heritable modules</li>
<li>Plotting modules, correlations, and module scores</li>
</ul>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">warnings</span><span class="p">;</span> <span class="n">warnings</span><span class="o">.</span><span class="n">simplefilter</span><span class="p">(</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">hotspot</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">matplotlib.colors</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>

<span class="kn">from</span> <span class="nn">scipy.io</span> <span class="k">import</span> <span class="n">mmread</span>
<span class="kn">from</span> <span class="nn">scipy.sparse</span> <span class="k">import</span> <span class="n">csr_matrix</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">counts_raw</span> <span class="o">=</span> <span class="n">mmread</span><span class="p">(</span><span class="s2">&quot;GSM3302829_embryo3_SeuratNorm.mtx.gz&quot;</span><span class="p">)</span>
<span class="n">counts_raw</span> <span class="o">=</span> <span class="n">csr_matrix</span><span class="p">(</span><span class="n">counts_raw</span><span class="p">)</span>
<span class="n">barcodes</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_table</span><span class="p">(</span><span class="s2">&quot;GSM3302829_embryo3_SeuratBarcodes.tsv.gz&quot;</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">None</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">barcodes</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">+</span><span class="s1">&#39;-1&#39;</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">barcodes</span><span class="p">]</span> <span class="c1"># to match the newick file</span>
<span class="n">genes</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_table</span><span class="p">(</span><span class="s2">&quot;GSM3302829_embryo3_SeuratGenes.tsv.gz&quot;</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">None</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Load the tree and enumerate the leaves</span>
<span class="kn">from</span> <span class="nn">ete3</span> <span class="k">import</span> <span class="n">Tree</span>
<span class="n">tree</span> <span class="o">=</span> <span class="n">Tree</span><span class="p">(</span><span class="s2">&quot;0726_E2-2_tree_greedy_priors.processed.txt&quot;</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">leaves</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
<span class="k">for</span> <span class="n">tn</span> <span class="ow">in</span> <span class="n">tree</span><span class="o">.</span><span class="n">traverse</span><span class="p">(</span><span class="s1">&#39;postorder&#39;</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">tn</span><span class="o">.</span><span class="n">is_leaf</span><span class="p">():</span>
        <span class="n">leaves</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">tn</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
<span class="nb">len</span><span class="p">(</span><span class="n">leaves</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
1756
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Subset the count matrix to only the cells where the lineage was recoverable</span>
<span class="n">is_valid</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="ow">in</span> <span class="n">leaves</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">barcodes</span><span class="p">]</span>
<span class="n">is_valid_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">is_valid</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">valid_barcodes</span> <span class="o">=</span> <span class="p">[</span><span class="n">barcodes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">is_valid_indices</span><span class="p">]</span>

<span class="n">counts</span> <span class="o">=</span> <span class="n">counts_raw</span><span class="p">[:,</span> <span class="n">is_valid_indices</span><span class="p">]</span><span class="o">.</span><span class="n">todense</span><span class="p">()</span>
<span class="n">counts</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">counts</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">genes</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">valid_barcodes</span><span class="p">)</span>

<span class="c1"># Subset for only genes detected in at least 10 cells</span>
<span class="n">counts</span> <span class="o">=</span> <span class="n">counts</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
    <span class="p">(</span><span class="n">counts</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">10</span>
<span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="Creating-the-Hotspot-object">
<h2>Creating the Hotspot object<a class="headerlink" href="#Creating-the-Hotspot-object" title="Permalink to this headline">¶</a></h2>
<p>To start an analysis, first create the hotspot object When creating the object, you need to specify:</p>
<ul class="simple">
<li>The gene counts matrix</li>
<li>Which background model to use</li>
<li>The latent space we are using to compute our cell metric<ul>
<li>Here we use the inferred cell tree</li>
</ul>
</li>
<li>The per-cell scaling factor<ul>
<li>Here we use the number of umi per barcode</li>
</ul>
</li>
</ul>
<p>In this case, only the <em>log-normalized counts</em> are made available. In the Hotspot publication, we used the raw counts and the negative binomial (‘danb’) model. However, to make this example easier to run, here we just supply the log-normalized counts and select the ‘normal’ model.</p>
<p>Once the object is created, the neighborhood is then computed with <code class="docutils literal notranslate"><span class="pre">create_knn_graph</span></code></p>
<p>The two options that are specificied are <code class="docutils literal notranslate"><span class="pre">n_neighbors</span></code> which determines the size of the neighborhood, and <code class="docutils literal notranslate"><span class="pre">weighted_graph</span></code>.</p>
<p>Here we set <code class="docutils literal notranslate"><span class="pre">weighted_graph=False</span></code> to just use binary, 0-1 weights (only binary weights are supported when using a lineage tree) and <code class="docutils literal notranslate"><span class="pre">n_neighbors=30</span></code> to create a local neighborhood size of the nearest 30 cells. Larger neighborhood sizes can result in more robust detection of correlations and autocorrelations at a cost of missing more fine-grained, smaller-scale patterns.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Create the Hotspot object and the neighborhood graph</span>

<span class="n">hs</span> <span class="o">=</span> <span class="n">hotspot</span><span class="o">.</span><span class="n">Hotspot</span><span class="p">(</span><span class="n">counts</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="s1">&#39;normal&#39;</span><span class="p">,</span> <span class="n">tree</span><span class="o">=</span><span class="n">tree</span><span class="p">)</span>

<span class="n">hs</span><span class="o">.</span><span class="n">create_knn_graph</span><span class="p">(</span>
    <span class="n">weighted_graph</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">n_neighbors</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
100%|██████████| 1756/1756 [00:16&lt;00:00, 110.57it/s]
</pre></div></div>
</div>
</div>
<div class="section" id="Determining-genes-with-heritable-variation">
<h2>Determining genes with heritable variation<a class="headerlink" href="#Determining-genes-with-heritable-variation" title="Permalink to this headline">¶</a></h2>
<p>Now we compute autocorrelations for each gene, using the lineage metric, to determine which genes have the most heritable variation.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">hs_results</span> <span class="o">=</span> <span class="n">hs</span><span class="o">.</span><span class="n">compute_autocorrelations</span><span class="p">(</span><span class="n">jobs</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="n">hs_results</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">15</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
100%|██████████| 12440/12440 [00:04&lt;00:00, 3046.79it/s]
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>C</th>
      <th>Z</th>
      <th>Pval</th>
      <th>FDR</th>
    </tr>
    <tr>
      <th>Gene</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Rhox5</th>
      <td>0.202858</td>
      <td>39.835987</td>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
    </tr>
    <tr>
      <th>Trap1a</th>
      <td>0.182587</td>
      <td>35.933251</td>
      <td>4.622486e-283</td>
      <td>2.204320e-279</td>
    </tr>
    <tr>
      <th>Mt1</th>
      <td>0.184857</td>
      <td>35.929364</td>
      <td>5.315884e-283</td>
      <td>2.204320e-279</td>
    </tr>
    <tr>
      <th>Mt2</th>
      <td>0.179544</td>
      <td>35.885161</td>
      <td>2.602714e-282</td>
      <td>8.094441e-279</td>
    </tr>
    <tr>
      <th>Lgals2</th>
      <td>0.179358</td>
      <td>34.875108</td>
      <td>8.864925e-267</td>
      <td>2.205593e-263</td>
    </tr>
    <tr>
      <th>Apom</th>
      <td>0.175625</td>
      <td>34.854555</td>
      <td>1.816081e-266</td>
      <td>3.765341e-263</td>
    </tr>
    <tr>
      <th>Ttr</th>
      <td>0.179074</td>
      <td>34.795900</td>
      <td>1.402761e-265</td>
      <td>2.492907e-262</td>
    </tr>
    <tr>
      <th>S100g</th>
      <td>0.169737</td>
      <td>33.828606</td>
      <td>3.745067e-251</td>
      <td>5.823579e-248</td>
    </tr>
    <tr>
      <th>Apoa1</th>
      <td>0.173526</td>
      <td>33.700644</td>
      <td>2.828200e-249</td>
      <td>3.909201e-246</td>
    </tr>
    <tr>
      <th>Rbp4</th>
      <td>0.172188</td>
      <td>33.636521</td>
      <td>2.454401e-248</td>
      <td>3.053275e-245</td>
    </tr>
    <tr>
      <th>Spink1</th>
      <td>0.160698</td>
      <td>31.947691</td>
      <td>2.908280e-224</td>
      <td>3.289000e-221</td>
    </tr>
    <tr>
      <th>Amn</th>
      <td>0.158660</td>
      <td>31.168848</td>
      <td>1.408731e-213</td>
      <td>1.460384e-210</td>
    </tr>
    <tr>
      <th>Afp</th>
      <td>0.159919</td>
      <td>30.329718</td>
      <td>2.325988e-202</td>
      <td>2.225792e-199</td>
    </tr>
    <tr>
      <th>Dab2</th>
      <td>0.155662</td>
      <td>30.315884</td>
      <td>3.539874e-202</td>
      <td>3.145431e-199</td>
    </tr>
    <tr>
      <th>Apoa2</th>
      <td>0.155262</td>
      <td>29.959592</td>
      <td>1.650030e-197</td>
      <td>1.368425e-194</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
</div>
<div class="section" id="Grouping-genes-into-lineage-based-modules">
<h2>Grouping genes into lineage-based modules<a class="headerlink" href="#Grouping-genes-into-lineage-based-modules" title="Permalink to this headline">¶</a></h2>
<p>To get a better idea of what heritable expression patterns exist, it is helpful to group the genes into modules.</p>
<p>Hotspot does this using the concept of “local correlations” - that is, correlations that are computed between genes between cells in the same neighborhood.</p>
<p>Here we avoid running the calculation for all Genes x Genes pairs and instead only run this on genes that have significant lineage autocorrelation to begin with.</p>
<p>The method <code class="docutils literal notranslate"><span class="pre">compute_local_correlations</span></code> returns a Genes x Genes matrix of Z-scores for the significance of the correlation between genes. This object is also retained in the <code class="docutils literal notranslate"><span class="pre">hs</span></code> object and is used in the subsequent steps.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Select the genes with significant lineage autocorrelation</span>
<span class="n">hs_genes</span> <span class="o">=</span> <span class="n">hs_results</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="n">hs_results</span><span class="o">.</span><span class="n">FDR</span> <span class="o">&lt;</span> <span class="mf">0.05</span><span class="p">]</span>

<span class="c1"># Compute pair-wise local correlations between these genes</span>
<span class="n">lcz</span> <span class="o">=</span> <span class="n">hs</span><span class="o">.</span><span class="n">compute_local_correlations</span><span class="p">(</span><span class="n">hs_genes</span><span class="p">,</span> <span class="n">jobs</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
 27%|██▋       | 450/1685 [00:00&lt;00:00, 4491.33it/s]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Computing pair-wise local correlation on 1685 features...
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
100%|██████████| 1685/1685 [00:00&lt;00:00, 4357.77it/s]
100%|██████████| 1418770/1418770 [01:17&lt;00:00, 18344.96it/s]
</pre></div></div>
</div>
<p>Now that pair-wise local correlations are calculated, we can group genes into modules.</p>
<p>To do this, a convenience method is included <code class="docutils literal notranslate"><span class="pre">create_modules</span></code> which performs agglomerative clustering with two caveats:</p>
<ul class="simple">
<li>If the FDR-adjusted p-value of the correlation between two branches exceeds <code class="docutils literal notranslate"><span class="pre">fdr_threshold</span></code>, then the branches are not merged.</li>
<li>If two branches are two be merged and they are both have at least <code class="docutils literal notranslate"><span class="pre">min_gene_threshold</span></code> genes, then the branches are not merged. Further genes that would join to the resulting merged module (and are therefore ambiguous) either remain unassigned (if <code class="docutils literal notranslate"><span class="pre">core_only=True</span></code>) or are assigned to the module with the smaller average correlations between genes, i.e.&nbsp;the least-dense module (if <code class="docutils literal notranslate"><span class="pre">core_only=False</span></code>)</li>
</ul>
<p>The output is a Series that maps gene to module number. Unassigned genes are indicated with a module number of <code class="docutils literal notranslate"><span class="pre">-1</span></code></p>
<p>This method was used to preserved substructure (nested modules) while still giving the analyst some control. However, since there are a lot of ways to do hierarchical clustering, you can also manually cluster using the gene-distances in <code class="docutils literal notranslate"><span class="pre">hs.local_correlation_z</span></code></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">modules</span> <span class="o">=</span> <span class="n">hs</span><span class="o">.</span><span class="n">create_modules</span><span class="p">(</span>
    <span class="n">min_gene_threshold</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">core_only</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fdr_threshold</span><span class="o">=</span><span class="mf">0.05</span>
<span class="p">)</span>

<span class="n">modules</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
 1    682
 2    566
-1    223
 3     84
 5     65
 4     65
Name: Module, dtype: int64
</pre></div></div>
</div>
</div>
<div class="section" id="Plotting-module-correlations">
<h2>Plotting module correlations<a class="headerlink" href="#Plotting-module-correlations" title="Permalink to this headline">¶</a></h2>
<p>A convenience method is supplied to plot the results of <code class="docutils literal notranslate"><span class="pre">hs.create_modules</span></code></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">hs</span><span class="o">.</span><span class="n">plot_local_correlations</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Lineage_Tutorial_15_0.png" src="_images/Lineage_Tutorial_15_0.png" />
</div>
</div>
<p>To explore individual genes, we can look at the genes with the top <em>autocorrelation</em> in a given module as these are likely the most informative.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Show the top genes for a module</span>

<span class="n">module</span> <span class="o">=</span> <span class="mi">3</span>

<span class="n">results</span> <span class="o">=</span> <span class="n">hs</span><span class="o">.</span><span class="n">results</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">hs</span><span class="o">.</span><span class="n">modules</span><span class="p">)</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">results</span><span class="o">.</span><span class="n">Module</span> <span class="o">==</span> <span class="n">module</span><span class="p">]</span>
<span class="n">results</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;Z&#39;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>C</th>
      <th>Z</th>
      <th>Pval</th>
      <th>FDR</th>
      <th>Module</th>
    </tr>
    <tr>
      <th>Gene</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Klf1</th>
      <td>0.083767</td>
      <td>15.732653</td>
      <td>4.517215e-56</td>
      <td>5.251790e-54</td>
      <td>3.0</td>
    </tr>
    <tr>
      <th>Hba-x</th>
      <td>0.067472</td>
      <td>12.765132</td>
      <td>1.283581e-37</td>
      <td>1.078902e-35</td>
      <td>3.0</td>
    </tr>
    <tr>
      <th>Hbb-bh1</th>
      <td>0.061915</td>
      <td>12.301353</td>
      <td>4.453501e-35</td>
      <td>3.551381e-33</td>
      <td>3.0</td>
    </tr>
    <tr>
      <th>Hba-a1</th>
      <td>0.058662</td>
      <td>10.890564</td>
      <td>6.392324e-28</td>
      <td>4.036574e-26</td>
      <td>3.0</td>
    </tr>
    <tr>
      <th>Hbb-y</th>
      <td>0.058233</td>
      <td>10.754297</td>
      <td>2.828191e-27</td>
      <td>1.733137e-25</td>
      <td>3.0</td>
    </tr>
    <tr>
      <th>Gypa</th>
      <td>0.053739</td>
      <td>10.322431</td>
      <td>2.789620e-25</td>
      <td>1.644686e-23</td>
      <td>3.0</td>
    </tr>
    <tr>
      <th>Blvrb</th>
      <td>0.049597</td>
      <td>9.756170</td>
      <td>8.679374e-23</td>
      <td>4.633966e-21</td>
      <td>3.0</td>
    </tr>
    <tr>
      <th>Anp32b</th>
      <td>0.047844</td>
      <td>9.041718</td>
      <td>7.711397e-20</td>
      <td>3.647520e-18</td>
      <td>3.0</td>
    </tr>
    <tr>
      <th>Alad</th>
      <td>0.042718</td>
      <td>8.496494</td>
      <td>9.770124e-18</td>
      <td>4.191046e-16</td>
      <td>3.0</td>
    </tr>
    <tr>
      <th>Hmbs</th>
      <td>0.038978</td>
      <td>7.810243</td>
      <td>2.853899e-15</td>
      <td>1.056622e-13</td>
      <td>3.0</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<p>To get an idea of what lineage patterns the module is referencing, we can plot the kernel values</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Load Kernel values</span>
<span class="kn">import</span> <span class="nn">gzip</span>
<span class="k">with</span> <span class="n">gzip</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;GSE122187_CellStateKernels.xls.gz&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fin</span><span class="p">:</span>
    <span class="n">kernels</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="n">fin</span><span class="p">,</span> <span class="n">skiprows</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;Gene&#39;</span><span class="p">)</span>

<span class="n">kernels</span> <span class="o">=</span> <span class="n">kernels</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
    <span class="p">:,</span> <span class="n">kernels</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">sort_values</span><span class="p">()</span>
<span class="p">]</span>

<span class="n">kernel_name_map</span> <span class="o">=</span> <span class="p">{</span>
    <span class="mi">0</span><span class="p">:</span> <span class="s2">&quot;trophoblast stem cells&quot;</span><span class="p">,</span>
    <span class="mi">1</span><span class="p">:</span> <span class="s2">&quot;neural ectoderm anterior&quot;</span><span class="p">,</span>
    <span class="mi">2</span><span class="p">:</span> <span class="s2">&quot;primitive streak late&quot;</span><span class="p">,</span>
    <span class="mi">3</span><span class="p">:</span> <span class="s2">&quot;anterior primitive streak&quot;</span><span class="p">,</span>
    <span class="mi">4</span><span class="p">:</span> <span class="s2">&quot;primitive/definitive endoderm&quot;</span><span class="p">,</span>
    <span class="mi">5</span><span class="p">:</span> <span class="s2">&quot;allantois&quot;</span><span class="p">,</span>
    <span class="mi">6</span><span class="p">:</span> <span class="s2">&quot;secondary heart field/splanchnic lateral plate&quot;</span><span class="p">,</span>
    <span class="mi">7</span><span class="p">:</span> <span class="s2">&quot;gut endoderm&quot;</span><span class="p">,</span>
    <span class="mi">8</span><span class="p">:</span> <span class="s2">&quot;ectoderm early 1&quot;</span><span class="p">,</span>
    <span class="mi">9</span><span class="p">:</span> <span class="s2">&quot;primitive blood early&quot;</span><span class="p">,</span>
    <span class="mi">10</span><span class="p">:</span> <span class="s2">&quot;preplacodal ectoderm&quot;</span><span class="p">,</span>
    <span class="mi">11</span><span class="p">:</span> <span class="s2">&quot;neural ectoderm posterior&quot;</span><span class="p">,</span>
    <span class="mi">12</span><span class="p">:</span> <span class="s2">&quot;posterior lateral plate mesoderm&quot;</span><span class="p">,</span>
    <span class="mi">13</span><span class="p">:</span> <span class="s2">&quot;hematopoietic/endothelial progenitors&quot;</span><span class="p">,</span>
    <span class="mi">14</span><span class="p">:</span> <span class="s2">&quot;parietal endoderm&quot;</span><span class="p">,</span>
    <span class="mi">15</span><span class="p">:</span> <span class="s2">&quot;amnion mesoderm early&quot;</span><span class="p">,</span>
    <span class="mi">16</span><span class="p">:</span> <span class="s2">&quot;surface ectoderm&quot;</span><span class="p">,</span>
    <span class="mi">17</span><span class="p">:</span> <span class="s2">&quot;epiblast&quot;</span><span class="p">,</span>
    <span class="mi">18</span><span class="p">:</span> <span class="s2">&quot;somites&quot;</span><span class="p">,</span>
    <span class="mi">19</span><span class="p">:</span> <span class="s2">&quot;ectoderm early 2&quot;</span><span class="p">,</span>
    <span class="mi">20</span><span class="p">:</span> <span class="s2">&quot;splanchnic lateral plate/anterior paraxial mesoderm&quot;</span><span class="p">,</span>
    <span class="mi">21</span><span class="p">:</span> <span class="s2">&quot;primitive heart tube&quot;</span><span class="p">,</span>
    <span class="mi">22</span><span class="p">:</span> <span class="s2">&quot;primitive blood late&quot;</span><span class="p">,</span>
    <span class="mi">23</span><span class="p">:</span> <span class="s2">&quot;notochord&quot;</span><span class="p">,</span>
    <span class="mi">24</span><span class="p">:</span> <span class="s2">&quot;fore/midbrain&quot;</span><span class="p">,</span>
    <span class="mi">25</span><span class="p">:</span> <span class="s2">&quot;distal extraembryonic ectoderm&quot;</span><span class="p">,</span>
    <span class="mi">26</span><span class="p">:</span> <span class="s2">&quot;neuromesodermal progenitor early&quot;</span><span class="p">,</span>
    <span class="mi">27</span><span class="p">:</span> <span class="s2">&quot;primordial germ cells&quot;</span><span class="p">,</span>
    <span class="mi">28</span><span class="p">:</span> <span class="s2">&quot;differentiated trophoblasts&quot;</span><span class="p">,</span>
    <span class="mi">29</span><span class="p">:</span> <span class="s2">&quot;visceral endoderm early&quot;</span><span class="p">,</span>
    <span class="mi">30</span><span class="p">:</span> <span class="s2">&quot;presomitic mesoderm&quot;</span><span class="p">,</span>
    <span class="mi">31</span><span class="p">:</span> <span class="s2">&quot;neuromesodermal progenitor late&quot;</span><span class="p">,</span>
    <span class="mi">32</span><span class="p">:</span> <span class="s2">&quot;angioblasts&quot;</span><span class="p">,</span>
    <span class="mi">33</span><span class="p">:</span> <span class="s2">&quot;neural crest&quot;</span><span class="p">,</span>
    <span class="mi">34</span><span class="p">:</span> <span class="s2">&quot;pharyngeal arch mesoderm&quot;</span><span class="p">,</span>
    <span class="mi">35</span><span class="p">:</span> <span class="s2">&quot;similar to neural crest&quot;</span><span class="p">,</span>
    <span class="mi">36</span><span class="p">:</span> <span class="s2">&quot;primitive blood progenitors&quot;</span><span class="p">,</span>
    <span class="mi">37</span><span class="p">:</span> <span class="s2">&quot;primitive streak early&quot;</span><span class="p">,</span>
    <span class="mi">38</span><span class="p">:</span> <span class="s2">&quot;node&quot;</span><span class="p">,</span>
    <span class="mi">39</span><span class="p">:</span> <span class="s2">&quot;future spinal cord&quot;</span><span class="p">,</span>
    <span class="mi">40</span><span class="p">:</span> <span class="s2">&quot;visceral endoderm late&quot;</span><span class="p">,</span>
    <span class="mi">41</span><span class="p">:</span> <span class="s2">&quot;amnion mesoderm late&quot;</span><span class="p">,</span>
<span class="p">}</span>

<span class="n">kernel_name_map</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span><span class="o">.</span><span class="n">capitalize</span><span class="p">()</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">kernel_name_map</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>

<span class="n">kernels</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">kernel_name_map</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">kernels</span><span class="o">.</span><span class="n">columns</span><span class="p">]</span>

<span class="c1"># Standardize each gene</span>
<span class="n">kernels_z</span> <span class="o">=</span> <span class="n">kernels</span> \
    <span class="o">.</span><span class="n">subtract</span><span class="p">(</span><span class="n">kernels</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> \
    <span class="o">.</span><span class="n">divide</span><span class="p">(</span><span class="n">kernels</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>


<span class="c1"># Plot the kernel values for the genes in each module</span>
<span class="n">mods</span> <span class="o">=</span> <span class="n">hs</span><span class="o">.</span><span class="n">modules</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
<span class="n">mods</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">mods</span> <span class="k">if</span> <span class="n">x</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">x</span><span class="p">)]</span>
<span class="n">mods</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">mods</span><span class="p">)</span>

<span class="n">sizes</span> <span class="o">=</span> <span class="p">[(</span><span class="n">hs</span><span class="o">.</span><span class="n">modules</span> <span class="o">==</span> <span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">mods</span><span class="p">]</span>
<span class="n">sizes</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">sizes</span><span class="p">]</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span>
    <span class="nb">len</span><span class="p">(</span><span class="n">mods</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">gridspec_kw</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">height_ratios</span><span class="o">=</span><span class="n">sizes</span><span class="p">,</span> <span class="n">right</span><span class="o">=.</span><span class="mi">8</span><span class="p">),</span>
    <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="mf">12.5</span><span class="p">)</span>
<span class="p">)</span>

<span class="n">cbax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_axes</span><span class="p">([</span><span class="o">.</span><span class="mi">85</span><span class="p">,</span> <span class="o">.</span><span class="mi">15</span><span class="p">,</span> <span class="o">.</span><span class="mi">015</span><span class="p">,</span> <span class="o">.</span><span class="mi">1</span><span class="p">])</span>

<span class="k">for</span> <span class="n">ax</span><span class="p">,</span> <span class="n">mod</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">axs</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span> <span class="n">mods</span><span class="p">):</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">sca</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>
    <span class="n">mod_genes</span> <span class="o">=</span> <span class="n">hs</span><span class="o">.</span><span class="n">modules</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="n">hs</span><span class="o">.</span><span class="n">modules</span> <span class="o">==</span> <span class="n">mod</span><span class="p">]</span>
    <span class="n">mod_genes</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Index</span><span class="p">(</span><span class="n">mod_genes</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">kernels</span><span class="o">.</span><span class="n">index</span>

    <span class="n">last_plot</span> <span class="o">=</span> <span class="n">mod</span> <span class="o">==</span> <span class="nb">max</span><span class="p">(</span><span class="n">mods</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">last_plot</span><span class="p">:</span>
        <span class="n">cbar</span><span class="o">=</span><span class="kc">True</span>
        <span class="n">cbar_ax</span><span class="o">=</span><span class="n">cbax</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">cbar</span><span class="o">=</span><span class="kc">False</span>
        <span class="n">cbar_ax</span><span class="o">=</span><span class="kc">None</span>

    <span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">kernels_z</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">mod_genes</span><span class="p">],</span> <span class="n">vmin</span><span class="o">=-</span><span class="mi">2</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;RdBu_r&quot;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">xticklabels</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">rasterized</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">cbar</span><span class="o">=</span><span class="n">cbar</span><span class="p">,</span> <span class="n">cbar_ax</span><span class="o">=</span><span class="n">cbar_ax</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">mod</span><span class="p">))</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">([])</span>

    <span class="k">if</span> <span class="n">last_plot</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">labelsize</span><span class="o">=</span><span class="mi">9</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">([])</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>

</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Lineage_Tutorial_19_0.png" src="_images/Lineage_Tutorial_19_0.png" />
</div>
</div>
</div>
<div class="section" id="Summary-Module-Scores">
<h2>Summary Module Scores<a class="headerlink" href="#Summary-Module-Scores" title="Permalink to this headline">¶</a></h2>
<p>To aid in the recognition of the general behavior of a module, Hotspot can compute aggregate module scores.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">module_scores</span> <span class="o">=</span> <span class="n">hs</span><span class="o">.</span><span class="n">calculate_module_scores</span><span class="p">()</span>

<span class="n">module_scores</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
  0%|          | 0/5 [00:00&lt;?, ?it/s]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Computing scores for 5 modules...
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
100%|██████████| 5/5 [00:00&lt;00:00,  3.03it/s]
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>1</th>
      <th>2</th>
      <th>3</th>
      <th>4</th>
      <th>5</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>AAACCTGAGAATAGGG-1</th>
      <td>-6.993694</td>
      <td>5.658538</td>
      <td>1.238681</td>
      <td>-0.743027</td>
      <td>-0.372733</td>
    </tr>
    <tr>
      <th>AAACCTGAGACCCACC-1</th>
      <td>-2.767821</td>
      <td>2.735488</td>
      <td>-1.299466</td>
      <td>0.587611</td>
      <td>0.333043</td>
    </tr>
    <tr>
      <th>AAACCTGAGCAGCGTA-1</th>
      <td>1.070490</td>
      <td>-0.881125</td>
      <td>-0.715067</td>
      <td>0.503891</td>
      <td>0.083320</td>
    </tr>
    <tr>
      <th>AAACCTGAGCCCAATT-1</th>
      <td>2.906480</td>
      <td>-1.453035</td>
      <td>-1.730925</td>
      <td>-0.576987</td>
      <td>-0.339215</td>
    </tr>
    <tr>
      <th>AAACCTGAGTACGACG-1</th>
      <td>-0.778300</td>
      <td>0.360248</td>
      <td>0.019698</td>
      <td>-0.247749</td>
      <td>0.733445</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<p>Here we can visualize these module scores by plotting them over a UMAP of the cells</p>
<p>First we’ll compute the UMAP</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">sklearn.decomposition</span> <span class="k">import</span> <span class="n">PCA</span>
<span class="kn">from</span> <span class="nn">umap</span> <span class="k">import</span> <span class="n">UMAP</span>

<span class="n">counts_z</span> <span class="o">=</span> <span class="n">counts</span> \
    <span class="o">.</span><span class="n">subtract</span><span class="p">(</span><span class="n">counts</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> \
    <span class="o">.</span><span class="n">divide</span><span class="p">(</span><span class="n">counts</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="n">pca_data</span> <span class="o">=</span> <span class="n">PCA</span><span class="p">(</span><span class="n">n_components</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">counts_z</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
<span class="n">umap_data</span> <span class="o">=</span> <span class="n">UMAP</span><span class="p">(</span><span class="n">n_neighbors</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">min_dist</span><span class="o">=.</span><span class="mi">5</span><span class="p">)</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">pca_data</span><span class="p">)</span>
<span class="n">umap_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">umap_data</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">counts</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;UMAP1&#39;</span><span class="p">,</span> <span class="s1">&#39;UMAP2&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
/data/yosef2/users/david.detomaso/programs/anaconda3/lib/python3.6/site-packages/sklearn/externals/joblib/__init__.py:15: DeprecationWarning: sklearn.externals.joblib is deprecated in 0.21 and will be removed in 0.23. Please import this functionality directly from joblib, which can be installed with: pip install joblib. If this warning is raised when loading pickled models, you may need to re-serialize those models with scikit-learn 0.21+.
  warnings.warn(msg, category=DeprecationWarning)
</pre></div></div>
</div>
<p>Next, let’s use the Kernels to assign every cell to its closest profile</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">scipy.spatial.distance</span> <span class="k">import</span> <span class="n">cdist</span>

<span class="n">common</span> <span class="o">=</span> <span class="n">counts</span><span class="o">.</span><span class="n">index</span> <span class="o">&amp;</span> <span class="n">kernels</span><span class="o">.</span><span class="n">index</span>
<span class="n">dd</span> <span class="o">=</span> <span class="n">cdist</span><span class="p">(</span><span class="n">counts</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">common</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">kernels</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">common</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">metric</span><span class="o">=</span><span class="s1">&#39;cosine&#39;</span><span class="p">)</span>
<span class="n">dd</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">dd</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">counts</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">kernels</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
<span class="n">assignment</span> <span class="o">=</span> <span class="n">dd</span><span class="o">.</span><span class="n">idxmin</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">counts</span><span class="o">.</span><span class="n">columns</span><span class="p">]</span>

<span class="n">colors</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">color_palette</span><span class="p">(</span><span class="s2">&quot;husl&quot;</span><span class="p">,</span> <span class="n">assignment</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="mi">9</span><span class="p">))</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ct</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">assignment</span><span class="o">.</span><span class="n">unique</span><span class="p">()):</span>
    <span class="n">ii</span> <span class="o">=</span> <span class="n">assignment</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="n">assignment</span> <span class="o">==</span> <span class="n">ct</span><span class="p">]</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">umap_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">UMAP1</span><span class="p">,</span> <span class="n">umap_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">UMAP2</span><span class="p">,</span>
            <span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">ms</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">ct</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">([])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">([])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;UMAP-1&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;UMAP-2&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">right</span><span class="o">=.</span><span class="mi">6</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=.</span><span class="mi">5</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper left&#39;</span><span class="p">,</span> <span class="n">markerscale</span><span class="o">=</span><span class="mi">3</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Lineage_Tutorial_25_0.png" src="_images/Lineage_Tutorial_25_0.png" />
</div>
</div>
<p>Finally, we plot the module scores on top of the UMAP for comparison</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">7</span><span class="p">))</span>
<span class="n">cax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_axes</span><span class="p">(</span>
    <span class="p">[</span><span class="o">.</span><span class="mi">72</span><span class="p">,</span> <span class="o">.</span><span class="mi">1</span><span class="p">,</span> <span class="o">.</span><span class="mi">007</span><span class="p">,</span> <span class="o">.</span><span class="mi">2</span><span class="p">]</span>
<span class="p">)</span>

<span class="k">for</span> <span class="n">ax</span><span class="p">,</span> <span class="n">mod</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">axs</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span> <span class="n">hs</span><span class="o">.</span><span class="n">module_scores</span><span class="o">.</span><span class="n">columns</span><span class="p">):</span>
    <span class="n">sc</span> <span class="o">=</span> <span class="n">hs</span><span class="o">.</span><span class="n">module_scores</span><span class="p">[</span><span class="n">mod</span><span class="p">]</span>
    <span class="c1"># vmin = np.percentile(sc, 5)</span>
    <span class="c1"># vmax = np.percentile(sc, 95)</span>
    <span class="n">vmin</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
    <span class="n">vmax</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">sca</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>
    <span class="n">sc</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
        <span class="n">umap_data</span><span class="o">.</span><span class="n">UMAP1</span><span class="p">,</span> <span class="n">umap_data</span><span class="o">.</span><span class="n">UMAP2</span><span class="p">,</span>
        <span class="n">s</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">sc</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">,</span>
        <span class="n">rasterized</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">([])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">([])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Module </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">mod</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">sp</span> <span class="ow">in</span> <span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
        <span class="n">sp</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">remove</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">hspace</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">sc</span><span class="p">,</span> <span class="n">cax</span><span class="o">=</span><span class="n">cax</span><span class="p">,</span> <span class="n">ticks</span><span class="o">=</span><span class="p">[</span><span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Module</span><span class="se">\n</span><span class="s1">Score&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="mf">0.02</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="mf">0.9</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Lineage_Tutorial_27_0.png" src="_images/Lineage_Tutorial_27_0.png" />
</div>
</div>
</div>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
    </p>
    <p>
        &copy; Copyright 2020, David DeTomaso.<br/>
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.8.2.<br/>
    </p>
  </div>
</footer>
  </body>
</html>